<!DOCTYPE html>
<html>
	<head>
		<title>Encryption</title>
	</head>
<body>
  <header>

    <div id="head">
      <img id="logo" src="https://i.ibb.co/Gdb8Crs/0.jpg" alt="Logo">
      <h1 id="headtext"><em>Message Encryptor</em></h1>

    </div>
    <div class="changers">
      <div class="selectors selected" id="s1">
        <h2><b>About</b></h2>
      </div>
      <div class="selectors nSelected" id="s2">
        <h2><b>Encryptor</b></h2>
      </div>
    </div>
    <p id="description">Have you ever wanted to send something so confidentially that no one who gets access to your phone can decrypt it?</n>
      Now you can with Message Encryptor!
      <p>

  </header>
  <div id="body2">
    <div id="main">
      </p>
      <form action="">
        <select name="services" id="select1">
    <option value="gPPK">Get Public/Private Key Pair</option>
    <option value="PKe">Encrypt with Public Key</option>
    <option value="dwPK">Decrypt with Private Key</option>
  </select>
      </form>
      <button id="generateButton">Generate</button>
      <button id="encryptButton">Encrypt</button>
      <button id="decryptButton">Decrypt</button>
      </n>
      </n>
      </n>
      <div id="desc">
        <div id="tips1">
          <ul>
            <li>Generate a set of keys by pressing the generate button.</li>
            <li>Send the public key to the message sender.</li>
            <li>Save the public and private keys to decript the sender's message.</li>
            <li>Make sure you store the keys in a secure place, or store them temporarily the text boxes below.</li>
          </ul>
        </div>
        <div id="tips2">
          <ul>
            <li>The sender uses the recipient's public key to encrypt their message on this page.</li>
            <li>The sender then sends the encrypted message back to the recipient.</li>
          </ul>
        </div>
        <div id="tips3">
          <ul>
            <li>The recipient uses their public and private keys to decode the sender's message.</li>
            <li>Even if someone obtains a record of every communication between the sender and recipient, it would be impossible to decode the sender's message.</li>
          </ul>
        </div>
      </div>
      <div id="boxes">
        <h3 id = "l1">Get Public Key:</h3>
        <textarea rows="3" cols="75" class="textField" id="textField1"></textarea>
        <h3 id = "l2">Get Public Key:</h3>
        <textarea rows="6" cols="75" class="textField" id="textField2"></textarea>
        <h3 id = "l3">Get Private Key:</h3>
        <textarea rows="6" cols="75" class="textField" id="textField3"></textarea>
      </div>
      <div id="storers">
        <div id="store1">
          <textarea rows="4" cols="75" class="textField" id="textStore1"></textarea>
          <h3><em>Store your public key</em></h3>
        </div>
        <div id="store2">
          <textarea rows="4" cols="75" class="textField" id="textStore2"></textarea>
          <h3><em>Store your private key</em></h3>
        </div>
        <div id="store3">
          <textarea rows="4" cols="75" class="textField" id="textStore3"></textarea>
          <h3><em>Store your encrypted message</em></h3>
        </div>
      </div>
    </div>
    <div id="about">
      <div id="inner">
        <p>
          This website uses a system in which someone can potentially view all of the communication between you and another person and still not know what you are telling each other. The system that is used for this is called RSA Encryption.
        </p>
        <div id="padded">
          <h2>How To Use!</h2>
          <p>Step 1: Generate a public- private key pair</p>
          <p>Step 2: Send public key to a friend so they can encrypt their messages to you</p>
          <p>Step 3: They respond with a message that they encrypt using your public key.</p>
          <p>Step 4: You decode their message using your private key.</p>
          <h2>How it works!</h2>
          <p>In order for the algorithm to work, it is necessary to have certain irreversable opperations that you can do on numbers that are easy to compute going forewards, but really really difficult to compute going backwards.</p>
          <p>With the private key, you can encrypt the message.</p>
          <p>Then you'll send the public key and message to your friend.</p>
          <p>They'll decipher it using the public key and then send a message back to you using their own private key.</p>
          <h2>ABOUT US: </h2>
          <p>We are a group of 4 High Schoolers who are putting together a way of making messaging even safer then before!</p>
          <p>Paul Shin: He was responsible for the RSA Algorithm</p>
          <p>Jason Leong: In charge of the logo, planning, and debugging.</p>
          <p>David Wallach: The programmer in charge of the website and debugger.</p>
          <p>Daniel Trager: Graphic and font designer and secondary debugger to the RSA Algorithm.</p>
        </div>
      </div>
    </div>
<style>
	#logo {
  position: absolute;
  width: 15vw;
  top: 1.8vw;
  left: 1.8vw;
}
#inner {
  margin-left: auto;
  margin-right: auto;
  padding: 1vw 1vw 1vw 1vw;
  border-radius: 0.4vw;
  width: 90%;
  background-color: #9fa9a3;
}
#body2 {
  width: 80%;
  background-color: #e3e0cc;
  color: #f0f0f0;
  padding-left: 10%;
  padding-right: 10%;
  padding-bottom: 2vw;
  font-family: "Arial", "Helvetica", "sans-serif";
}
header {
  display: inline-block;
  text-align: center;
  background-color: #e3e0cc;
  width: 100%;
  padding: 0px 0px 0px 0px;
  color: #3d3d3d;
}
#head {
  margin-left: auto;
  margin-right: auto;
  width: 90%;
  height: 6vw;
}
#description {
  font-size: 2vw;
  width: 80%;
  color: #3d3d3d;
  margin-left: auto;
  margin-right: auto;
}
#headtext {
  margin-left: auto;
  margin-right: auto;
  width: 55%;
  font-size: 5vw;
  color: #3d3d3d;
}
.changers {
  font-family: "Arial", "Helvetica", "sans-serif";
  width: 95%;
  height: 4vw;
  font-size: 1vw;
  color: #3d3d3d;
  background-color: #e3e0cc;
  margin-left:auto;
  margin-right:auto;
}
.selected {
  background-color: #dce8dc;
}
.nSelected {
  background-color: #c5d5c5;
}
#s1 {
  margin-top: auto;
  margin-bottom: auto;
  height: 3.8vw;
  width: 49.5%;
  border: solid;
  border-width: 1px;
  border-color: a8a8a8;
  border-radius: 0.4vw;
  text-align: center;
  float: left;
}
#s2 {
  border: solid;
  border-color: a8a8a8;
  border-width: 1px;
  margin-top: auto;
  margin-bottom: auto;
  height: 3.8vw;
  width: 49.5%;
  border-radius: 0.4vw;
  text-align: center;
  float: right;
}
#padded p {
  padding-left: 4%;
}
#about {
  padding-top: 2vw;
}

button {
  float: left;
  border: none;
  color: black;
  padding: 1.5vw 3vw;
  text-align: center;
  display: inline-block;
  font-size: 1vw;
  margin: 0.4vw 0.8vw;
  -webkit-transition-duration: 0.4s;
  transition-duration: 0.4s;
  cursor: pointer;
  text-decoration: none;
  text-transform: uppercase;
}
button:hover {
  background-color: #9fa9a3;
  color: white;
}
#select1 {
  font-size: .9vw;
  margin: .1333333vw 0.66666vw;
  cursor: pointer;
  display: inline-block;
}
#boxes {
  width: 40%;
  float: right;
  margin-right: 5%;
  font-size:.75vw;
}
#boxes textarea{
  font-size:.75vw;
}
#boxes h3{
  color:#000;
  font-size:1vw;
}
#desc {
  top: 0vw;
  float: left;
  width: 25%;
  color: #3d3d3d;
  margin-left: 3%;
  font-size:1.3vw;
}
#storers {
  width: 100%;
  height:30vw;
  margin-top:25vw;
}
#storers textarea{
  height:30%;
  margin-left:10%;
  margin-bottom:2%;
  float:left;
  font-size:1vw;
  width:40%;
}
#storers h3 {
  color: #3d3d3d;
  width: 30%;
  text-align: left;
  float: right;
  font-size: 1.5vw;
  margin-right:17%;
}


</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
	$(document).ready(function() {
  var pList = [
    1013,
    1019,
    1021,
    1031,
    1033,
    1039,
    1049,
    1051,
    1061,
    1063,
    1069,
    1087,
    1091,
    1093,
    1097,
    1103,
    1109,
    1117,
    1123,
    1129,
    1151,
    1153,
    1163,
    1171,
    1181,
    1187,
    1193,
    1201,
    1213,
    1217,
    1223,
    1229,
    1231,
    1237,
    1249,
    1259,
    1277,
    1279,
    1283,
    1289,
    1291,
    1297,
    1301,
    1303,
    1307,
    1319,
    1321,
    1327,
    1361,
    1367,
    1373,
    1381,
    1399,
    1409,
    1423,
    1427,
    1429,
    1433,
    1439,
    1447,
    1451,
    1453,
    1459,
    1471,
    1481,
    1483,
    1487,
    1489,
    1493,
    1499,
    1511,
    1523,
    1531,
    1543,
    1549,
    1553,
    1559,
    1567,
    1571,
    1579,
    1583,
    1597,
    1601,
    1607,
    1609,
    1613,
    1619,
    1621,
    1627,
    1637,
    1657,
    1663,
    1667,
    1669,
    1693,
    1697,
    1699,
    1709,
    1721,
    1723,
    1733,
    1741,
    1747,
    1753,
    1759,
    1777,
    1783,
    1787,
    1789,
    1801,
    1811,
    1823,
    1831,
    1847,
    1861,
    1867,
    1871,
    1873,
    1877,
    1879,
    1889,
    1901,
    1907,
    1913,
    1931,
    1933,
    1949,
    1951,
    1973,
    1979,
    1987,
    1993,
    1997,
    1999,
    2003
  ];
  var letters = {
    a: 0,
    b: 1,
    c: 2,
    d: 3,
    e: 4,
    f: 5,
    g: 6,
    h: 7,
    i: 8,
    j: 9,
    k: 10,
    l: 11,
    m: 12,
    n: 13,
    o: 14,
    p: 15,
    q: 16,
    r: 17,
    s: 18,
    t: 19,
    u: 20,
    v: 21,
    w: 22,
    x: 23,
    y: 24,
    z: 25,
    A: 26,
    B: 27,
    C: 28,
    D: 29,
    E: 30,
    F: 31,
    G: 32,
    H: 33,
    I: 34,
    J: 35,
    K: 36,
    L: 37,
    M: 38,
    N: 39,
    O: 40,
    P: 41,
    Q: 42,
    R: 43,
    S: 44,
    T: 45,
    U: 46,
    V: 47,
    W: 48,
    X: 49,
    Y: 50,
    Z: 51,
    "0": 52,
    "1": 53,
    "2": 54,
    "3": 55,
    "4": 56,
    "5": 57,
    "6": 58,
    "7": 59,
    "8": 60,
    "9": 61,
    "!": 62,
    "?": 63,
    ":": 64,
    ";": 65,
    ".": 66,
    ",": 67,
    " ": 68,
    "-": 69
  };
  var numbers = {};
  var sz = 3;  //length of message split. make longer to slow down but increase security.
  var num_chars = Object.keys(letters).length;
  function getMaxNumForStringLength(n){
    return num_chars*(1-Math.pow(num_chars,n))/(1-num_chars) + 1;
  }
  for (var key in letters) {
    var value = letters[key];
    numbers[value] = key;
  }
  
  
  //these functions convert strings to numbers and back
  //the first set of functions do not care about trailing "a"s
  //number_to_string(string_to_number("hia")) === number_to_string(string_to_number("hi"))
  
  function string_to_number(m) {
    var new_msg = 0;
    for (var i = 0; i < m.length; i++) {
      new_msg += letters[m[i]] * Math.pow(num_chars, i);
    }
    return new_msg;
  }
  function number_to_string(n) {
    var text = "";
    var i = Math.floor(Math.log(n)/Math.log(num_chars));
    //this method coverts a number of base 10 to a number of base m
    //i is the number of digits in the base m number.
    for (var j = i; j > -1; j--) {
      var multiplier = Math.pow(num_chars, j);
      text = numbers[Math.floor(n / multiplier)] + text;
      n = n % multiplier;
    }
    return text;
  }
  function original_s2n(m){
    if(m === ""){
      return 0;
    }
    var out = 0;
    var mlen = m.length;
    out+=getMaxNumForStringLength(mlen-1);
    out+=string_to_number(m);
    return out;
  }
  function original_n2s(n){
    var i = 0;
    while(n>=getMaxNumForStringLength(i)){
      i++;
    }
    i--;
    n-=getMaxNumForStringLength(i);
    var out = number_to_string(n);
    var outlen = out.length;
    for(var j = 0; j<=i-outlen;j++){
      out += numbers[0];
    }
    return out;
  }
  
  
  
  function gcd(a, b) {
    if (b === 0) {
      return a;
    }
    return gcd(b, a % b);
  }
  var fastModularExponentiation = function(a, b, n) {
    a = a % n;
    var result = 1;
    var x = a;

    while (b > 0) {
      var leastSignificantBit = b % 2;
      b = Math.floor(b / 2);

      if (leastSignificantBit == 1) {
        result = result * x;
        result = result % n;
      }

      x = x * x;
      x = x % n;
    }
    return result;
  };
  function public_exponent(phi) {
    for (var i = 3; i < phi; i += 2) {
      if (gcd(i, phi) === 1) {
        return i;
      }
    }
    alert(phi + " made it through the for loop. This means something went wrong.");
  }
  function d_value(phi, e) {
    var k = 1;
    while (true) {
      if ((k * phi + 1) % e === 0) {
        return Math.floor((k * phi + 1) / e);
      }
      k++;
    }
  }
  function choosePrimes() {
    var l = pList.length;
    var p1 = pList[Math.floor(Math.random() * l)];
    var p2 = pList[Math.floor(Math.random() * l)];
    while (p1 === p2) {
      p1 = pList[Math.floor(Math.random() * l)];
      p2 = pList[Math.floor(Math.random() * l)];
    }
    return [p1, p2];
  }
  function create_keys() {
    var primes = choosePrimes();
    var p1 = primes[0];
    var p2 = primes[1];
    var n = p1 * p2;
    var phi = (p1 - 1) * (p2 - 1);
    var e = public_exponent(phi);
    var d = d_value(phi, e);
    var public_key = [n, e];
    var private_key = [n, d];
    return [public_key, private_key];
  }
  
  function encrypt_message(message, public_key) {
    var numerical_msg = original_s2n(message);
    n = public_key[0];
    e = public_key[1];
    var x = e % (n - 1);
    if(numerical_msg>n){
      alert(numerical_msg + " uh oh, something went wrong.");
    }
    var out = fastModularExponentiation(numerical_msg,x,n);
    if(out.toString.length>maxLength(public_key[0])){
      alert(out + "\n" + out.toString.length);
      alert("the max length is " + maxLength(public_key[0]) + "\n" + "and the public key is " + public_key[0]);
    }
    return out;
  }
  
  function decrypt_message(encrypted_message, private_key) {
    n = private_key[0];
    d = private_key[1];
    var num_msg = fastModularExponentiation(encrypted_message, d, n);
    return original_n2s(num_msg);
  }
  function maxLength(n){
    return Math.floor(Math.log(n)/Math.log(num_chars)) + 1;
  }
  $("#generateButton").show();
  $("#encryptButton").hide();
  $("#decryptButton").hide();
  $("#textField1").hide();
  $("#textField2").show();
  $("#textField2").show();
  $("#textField4").hide();
  $("#textField2").attr("readonly", "readonly");
  $("#textField3").attr("readonly", "readonly");
  $("#textField4").attr("readonly", "readonly");
  $("#textField2").attr("placeholder", "Here you will get your public key.");
  $("#textField3").attr("placeholder", "Here you will get your private key.");
  $("#tips1").show();
  $("#tips2").hide();
  $("#tips3").hide();
  $("#l1").hide();
  var toggle = false;
  $("#main").hide();
  $("#s1").click(function() {
    if (toggle) {
      $("#main").hide();
      $("#about").show();
      toggle = false;
      $("#s1").addClass("selected");
      $("#s1").removeClass("nSelected");
      $("#s2").addClass("nSelected");
      $("#s2").removeClass("Selected");
    }
  });
  $("#s2").click(function() {
    if (!toggle) {
      $("#main").show();
      $("#about").hide();
      toggle = true;
      $("#s2").addClass("selected");
      $("#s2").removeClass("nSelected");
      $("#s1").addClass("nSelected");
      $("#s1").removeClass("Selected");
    }
  });
  function clearTextAreas() {
    $("#textField1").val("");
    $("#textField2").val("");
    $("#textField3").val("");
  }
  $("#select1").change(function() {
    if ($("#select1").val() === "gPPK") {
      clearTextAreas();
      $("#generateButton").show();
      $("#encryptButton").hide();
      $("#decryptButton").hide();
      $("#textField1").hide();
      $("#textField2").show();
      $("#textField3").show();
      $("#textField2").attr("readonly", "readonly");
      $("#textField3").attr("readonly", "readonly");
      $("#textField2").attr(
        "placeholder",
        "Here you will get your public key."
      );
      $("#textField3").attr(
        "placeholder",
        "Here you will get your private key."
      );
      $("#tips1").show();
      $("#tips2").hide();
      $("#tips3").hide();
      $("#l1").hide();
      $("#l2").show();
      $("#l3").show();
      $("#l2").text("Get Public Key:");
      $("#l3").text("Get Private Key:");
      $("#storers").css("margin-top","25vw");
    } else if ($("#select1").val() === "PKe") {
      clearTextAreas();
      $("#generateButton").hide();
      $("#encryptButton").show();
      $("#decryptButton").hide();
      $("#textField1").show();
      $("#textField2").show();
      $("#textField3").show();
      $("#textField1").removeAttr("readonly", "readonly");
      $("#textField2").removeAttr("readonly", "readonly");
      $("#textField3").attr("readonly", "readonly");
      $("#textField1").attr("placeholder", "Enter public key.");
      $("#textField2").attr("placeholder", "Enter message.");
      $("#textField3").attr("placeholder", "Encrypted message.");
      $("#tips1").hide();
      $("#tips2").show();
      $("#tips3").hide();
      $("#l1").show();
      $("#l2").show();
      $("#l3").show();
      $("#l1").text("Enter Public Key:");
      $("#l2").text("Enter Message:");
      $("#l3").text("Get Encrypted Message:");
      $("#storers").css("margin-top","32vw");
    } else if ($("#select1").val() === "dwPK") {
      clearTextAreas();
      $("#generateButton").hide();
      $("#encryptButton").hide();
      $("#decryptButton").show();
      $("#textField1").show();
      $("#textField2").show();
      $("#textField1").removeAttr("readonly", "readonly");
      $("#textField2").removeAttr("readonly", "readonly");
      $("#textField1").attr("placeholder", "Enter private key.");
      $("#textField2").attr("placeholder", "Enter encrypted message.");
      $("#textField3").attr("placeholder", "Decrypted message will appear.");
      $("#tips1").hide();
      $("#tips2").hide();
      $("#tips3").show();
      $("#l1").show();
      $("#l2").show();
      $("#l3").show();
      $("#l1").text("Enter Private Key:");
      $("#l2").text("Enter Encrypted Message:");
      $("#l3").text("Get Decrypted Message:");
      $("#storers").css("margin-top","32vw");
    }
  });
  $("#generateButton").click(function() {
    var PPks = create_keys();
    $("#textField2").val(PPks[0][0] + " " + PPks[0][1]);
    $("#textField3").val(PPks[1][0] + " " + PPks[1][1]);
  });
  $("#encryptButton").click(function() {
    var PKstr = $("#textField1").val();
    var PK = PKstr.split(" ");
    var encrypted_message = [];
    var ems = $("#textField2").val();
    for (var i = 0; i < ems.length; i += sz) {
      var diff = ems.length - i;
      if (diff > sz) {
        encrypted_message.push(encrypt_message(ems.substring(i, i + sz), PK));
      } else {
        encrypted_message.push(encrypt_message(ems.substring(i, i + diff), PK));
      }
    }
    var mL = maxLength(PK[0]); //to know the maximum amount of letters an encrypted number could be
    var out = "";
    for (var j = 0; j < encrypted_message.length; j++) {
      var numString = number_to_string(encrypted_message[j]);
      var diffInDigits = maxLength(PK[0]) - numString.length;
      //alert("diff: " + diffInDigits + " original: " + numString);
      out += numString;
      for(var k = 0; k<diffInDigits;k++){
        out+="a";
      }
    }
    
    $("#textField3").val(out);
  });
  $("#decryptButton").click(function() {
    var PrKstr = $("#textField1").val();
    var PrK = PrKstr.split(" ");
    var emsStr = $("#textField2").val();
    var ems = [];
    var mL = maxLength(PrK[0]);
    for (var i = 0; i < emsStr.length; i += mL) {
      
      var diff = emsStr.length - i;
      if (diff >= mL) {
        ems.push(string_to_number(emsStr.substring(i, i + mL)));
      } else {
        alert("it happened:(");
        ems.push(string_to_number(emsStr.substring(i, i + diff))); //shouldnt happen but just in case
      }
    }
    var decrypted_message = "";
    for (var j = 0; j < ems.length; j++) {
      decrypted_message += decrypt_message(ems[j], PrK);
    }
    $("#textField3").val(decrypted_message);
  });
});


</script>
</body>
</html>
